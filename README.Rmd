---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# raadle.humm

<!-- badges: start -->
<!-- badges: end -->

The goal of raadle.humm is to ...


## Example

This is a basic example which shows you how to solve a common problem:

```{r example}
datadir <- normalizePath(file.path("~", "bower_dir"), mustWork = FALSE) #"/bower"
print(datadir)
print(here::here("data-raw"))
fs::dir_ls(datadir, recurse = TRUE)

```


These are weird files because they are fairly hopeless HDF4Image with no metadata and GeoTIFFs with Byte values with a colour table. Happily the byte values are 8-bit integers between 0 and 120, with 0 and 120 being special values for zero and land. In the colour table zero is blue (139) and land is grey (100). All other values 1:100 are a guady spectrum, so we just use the numbers. 

Process to a raster data set. 

```{r terra}
library(dplyr)
library(terra)
files <- tibble::tibble(fullname = fs::dir_ls("~/bower_dir/", recurse = T, regexp = ".*(tif|hdf)$"))

hdfiles <- files |> filter(grepl(".*hdf$", fullname))
files <- files |> filter(grepl(".*tif$", fullname))


r <- rast(files$fullname[nrow(files)])
coltab(r) <- NULL
r[r > 100] <- NA
plot(r, col = hcl.colors(101))
contour(r, level = 15, add = T, lwd = 2)
```

Or, with the HDF we get sub-integer values we just need to use the georef from the tif. 

```{r hdf}
hdf <- rast(hdfiles$fullname[nrow(hdfiles)])

set.ext(hdf, ext(r))
set.crs(hdf, crs(r))
hdf <- flip(hdf)
plot(r)
contour(hdf, add = TRUE, lwd = 2, level = 15)
plot(abs(r - hdf))  ## see there is sub-integer information (do we care?)
```

